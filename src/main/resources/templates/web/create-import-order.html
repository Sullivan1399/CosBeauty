<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Tạo đơn nhập hàng</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;600;900&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Cairo', sans-serif;
    }
    .form-section-title {
      font-weight: 600;
      margin-top: 20px;
      margin-bottom: 10px;
    }
    .add-row-btn {
      margin-top: 10px;
    }
    .form-control {
      border-radius: 0.5rem;
    }
    .btn {
      border-radius: 0.5rem;
    }
  </style>
</head>
<body class="container mt-4">

<h2 class="mb-4">Tạo đơn nhập hàng mới</h2>

<!-- Thông báo thành công -->
<div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
  <span th:text="${successMessage}"></span>
  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>

<!-- Form tạo đơn -->
<form th:action="@{/employee/import-orders/create}" method="post" class="row g-3">

  <!-- Nhà cung cấp -->
  <div class="col-md-6">
    <label for="supplier" class="form-label">Nhà cung cấp</label>
    <select id="supplier" name="supplierId" class="form-select" required>
      <option value="" disabled selected>-- Chọn nhà cung cấp --</option>
      <option th:each="sup : ${suppliers}" th:value="${sup.supID}" th:text="${sup.supName}"></option>
    </select>
  </div>

  <!-- Tổng chi phí -->
  <div class="col-md-6">
    <label for="totalCost" class="form-label">Tổng chi phí</label>
    <input type="number" id="totalCost" name="cost" step="1000" class="form-control" placeholder="Nhập tổng chi phí..." required>
  </div>

  <!-- Chi tiết sản phẩm -->
  <div class="col-12">
    <h5 class="form-section-title">Chi tiết sản phẩm</h5>
    <table class="table table-bordered align-middle" id="product-details">
      <thead class="table-light">
      <tr>
        <th>Sản phẩm</th>
        <th>Số lượng</th>
        <th>Giá nhập</th>
        <th>Thao tác</th>
      </tr>
      </thead>
      <tbody>
      <tr>
        <td>
          <select name="productIds" class="form-select" required>
            <option value="" disabled selected>-- Chọn sản phẩm --</option>
            <option th:each="p : ${products}" th:value="${p.productID}" th:text="${p.productName}"></option>
          </select>
        </td>
        <td><input type="number" name="quantities" class="form-control" min="1" required></td>
        <td><input type="number" name="costs" class="form-control" step="1000" required></td>
        <td class="text-center">
          <button type="button" class="btn btn-danger btn-sm" onclick="removeProductRow(this)">X</button>
        </td>
      </tr>
      </tbody>
    </table>
    <button type="button" class="btn btn-outline-primary btn-sm add-row-btn" onclick="addProductRow()">+ Thêm sản phẩm</button>
  </div>

  <!-- Nút Lưu -->
  <div class="col-12 text-end mt-3">
    <button type="submit" class="btn btn-success">Tạo đơn nhập</button>
    <a href="/employee/import-orders" class="btn btn-secondary ms-2">Quay lại</a>
  </div>

</form>

<!-- Template option sản phẩm -->
<div id="product-options-template" hidden>
  <option value="" disabled selected>-- Chọn sản phẩm --</option>
  <option th:each="p : ${products}" th:value="${p.productID}" th:text="${p.productName}"></option>
</div>

<!-- Script thêm & xóa dòng sản phẩm -->
<script>
  function addProductRow() {
    const container = document.querySelector('#product-details tbody');
    const newRow = container.firstElementChild.cloneNode(true);

    // Clear input values
    newRow.querySelectorAll('input').forEach(el => el.value = '');

    // Reset select
    const productSelect = newRow.querySelector('select[name="productIds"]');
    const optionTemplate = document.getElementById('product-options-template').innerHTML;
    productSelect.innerHTML = optionTemplate;

    container.appendChild(newRow);
  }

  function removeProductRow(button) {
    const row = button.closest('tr');
    const table = document.querySelector('#product-details tbody');

    if (table.rows.length > 1) {
      row.remove();
    } else {
      alert("Phải có ít nhất một dòng sản phẩm.");
    }
  }
</script>

</body>
</html>
