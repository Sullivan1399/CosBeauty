<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Cập nhật tài khoản người dùng</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;600;900&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-4">

<h2 class="mb-4">Cập nhật tài khoản người dùng</h2>

<!-- THÔNG BÁO -->
<div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
<div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

<!-- FORM TÌM KIẾM -->
<form th:action="@{/admin/users}" method="get" class="row mb-3 justify-content-end">
  <div class="col-md-6">
    <input type="text" name="keyword" class="form-control"
           placeholder="Tìm theo email hoặc số điện thoại"
           th:value="${keyword}">
  </div>
  <div class="col-md-2">
    <button type="submit" class="btn btn-primary w-100">Tìm kiếm</button>
  </div>
</form>

<!-- BUTTON THÊM NHÂN VIÊN -->
<div class="mb-4 text-end">
  <a href="/admin/users/create-employee" class="btn btn-success">Thêm tài khoản Nhân viên</a>
</div>

<!-- FILTER ROLE -->
<div class="mb-3">
  <form method="get" action="/admin/users" class="d-inline">
    <input type="hidden" name="role" value="customer" />
    <button type="submit" class="btn btn-info">Danh sách Khách hàng</button>
  </form>

  <form method="get" action="/admin/users" class="d-inline ms-2">
    <input type="hidden" name="role" value="employee" />
    <button type="submit" class="btn btn-info">Danh sách Nhân viên</button>
  </form>

  <form method="get" action="/admin/users" class="d-inline ms-2">
    <button type="submit" class="btn btn-info">ALL</button>
  </form>
</div>

<!-- DANH SÁCH NGƯỜI DÙNG -->
<table class="table table-bordered table-striped align-middle">
  <thead class="table-light">
  <tr>
    <th>ID</th>
    <th>Tên người dùng</th>
    <th>Email</th>
    <th>Số điện thoại</th>
    <th>Vai trò</th>
    <th>Hành động</th>
  </tr>
  </thead>
  <tbody>
  <th:block th:each="account : ${accounts}">
    <tr>
      <td>
        <form th:action="@{/admin/users}" method="post">
          <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
          <input type="hidden" name="id" th:value="${account.ID}" />
          <span th:text="${account.ID}"></span>
      </td>

      <td>
        <input type="email"
               name="Name"
               th:value="${account.displayName}"
               class="form-control form-control-sm"
               readonly />
      </td>

      <td>
        <span th:text="${account.username}" class="form-control form-control-sm"></span>
      </td>

      <td>
        <input type="text"
               name="newPhone"
               th:value="${phoneMap[account.username]}"
               class="form-control form-control-sm"
               required />
      </td>

      <td>
            <span th:text="${account.role == 'ROLE_CUSTOMER' ? 'Khách hàng' :
                            account.role == 'ROLE_EMPLOYEE' ? 'Nhân viên' : 'Quản trị'}"></span>
        <input type="hidden" name="role"
               th:value="${account.role.replace('ROLE_', '')}" />
      </td>
      <td>
        <button type="submit" class="btn btn-warning btn-sm">Lưu</button>
        </form> <!-- form đóng ở cuối cột -->
      </td>
    </tr>
  </th:block>
  </tbody>
</table>

<!-- PHÂN TRANG -->
<div class="d-flex justify-content-center">
  <nav>
    <ul class="pagination">
      <li class="page-item" th:if="${currentPage > 1}">
        <a class="page-link" th:href="@{/admin/users(page=${currentPage - 1})}">Trước</a>
      </li>
      <li class="page-item" th:each="i : ${#numbers.sequence(1, totalPages)}"
          th:classappend="${i == currentPage} ? 'active'">
        <a class="page-link" th:href="@{/admin/users(page=${i})}" th:text="${i}"></a>
      </li>
      <li class="page-item" th:if="${currentPage < totalPages}">
        <a class="page-link" th:href="@{/admin/users(page=${currentPage + 1})}">Tiếp</a>
      </li>
    </ul>
  </nav>
</div>

<!-- NÚT QUAY LẠI -->
<div class="mb-3 text-end">
  <button type="button" class="btn btn-secondary" onclick="window.history.back()">Quay lại</button>
</div>

</body>
</html>
