<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CosBeauty - ƒê∆°n h√†ng</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #ff6200;
      --secondary-color: #ff8533;
      --light-color: #fff4eb;
      --dark-color: #333;
      --border-color: #e0e0e0;
    }
    
    body {
      font-family: 'Roboto', sans-serif;
      background-color: #f8f9fa;
      height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    
    .header {
      background-color: var(--primary-color);
      color: white;
      padding: 10px 0;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .header-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 15px;
    }
    
    .logo-search-container {
      display: flex;
      align-items: center;
      flex: 1;
    }
    
    .logo {
      height: 40px;
      margin-right: 20px;
    }
    
    .search-bar {
      position: relative;
      flex: 1;
      max-width: 500px;
    }
    
    .search-bar input {
      border-radius: 20px;
      padding-left: 40px;
      border: none;
      height: 38px;
      width: 100%;
    }
    
    .search-icon {
      position: absolute;
      left: 15px;
      top: 10px;
      color: #888;
    }
    
    .user-menu {
      position: relative;
      margin-left: 20px;
    }
    
    .user-menu .dropdown-toggle {
      color: white;
      text-decoration: none;
      cursor: pointer;
      display: flex;
      align-items: center;
    }
    
    .user-menu .dropdown-toggle i {
      margin-right: 5px;
    }
    
    .user-menu .dropdown-menu {
      position: absolute;
      right: 0;
      left: auto;
      top: 100%;
      background-color: white;
      border-radius: 4px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 10px 0;
      min-width: 200px;
      z-index: 1000;
      display: none;
    }
    
    .user-menu .dropdown-menu.show {
      display: block;
    }
    
    .user-menu .dropdown-menu a {
      display: block;
      padding: 8px 20px;
      color: var(--dark-color);
      text-decoration: none;
    }
    
    .user-menu .dropdown-menu a:hover {
      background-color: var(--light-color);
    }
    
    .logout-btn {
      background: none;
      border: none;
      width: 100%;
      text-align: left;
      padding: 8px 20px;
      color: var(--dark-color);
      cursor: pointer;
    }
    
    .logout-btn:hover {
      background-color: var(--light-color);
    }
    
    .dropdown-divider {
      border-top: 1px solid var(--border-color);
      margin: 5px 0;
    }
    
    .main-content {
      display: flex;
      flex: 1;
      overflow: hidden;
    }
    
    .left-panel {
      flex: 7;
      padding: 15px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    
    .right-panel {
      flex: 3;
      background-color: white;
      border-left: 1px solid var(--border-color);
      padding: 15px;
      box-shadow: -2px 0 5px rgba(0,0,0,0.05);
    }
    
    .order-table-container {
      flex: 1;
      overflow-y: auto;
      margin-bottom: 10px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
    }
    
    .order-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .order-table th {
      background-color: #f2f2f2;
      padding: 10px;
      text-align: left;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    
    .order-table td {
      padding: 10px;
      border-top: 1px solid var(--border-color);
    }
    
    .order-table img {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 4px;
    }
    
    .quantity-control {
      display: flex;
      align-items: center;
    }
    
    .quantity-control button {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      border: none;
      background-color: var(--primary-color);
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    
    .quantity-control span {
      margin: 0 10px;
      min-width: 30px;
      text-align: center;
    }
    
    .note-container {
      margin-top: 10px;
      position: sticky;
      bottom: 0;
      background-color: white;
      padding: 10px 0;
      border-top: 1px solid var(--border-color);
    }
    
    .note-input {
      width: 100%;
      padding: 10px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
    }
    
    .create-order-btn {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
    }
    
    .create-order-btn:hover {
      background-color: var(--secondary-color);
    }
    
    .order-summary {
      height: 100%;
      display: flex;
      flex-direction: column;
    }
    
    .summary-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border-color);
    }
    
    .summary-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
    }
    
    .summary-row.highlight {
      font-weight: bold;
      color: var(--primary-color);
    }
    
    .payment-methods {
      margin: 20px 0;
    }
    
    .payment-methods label {
      margin-right: 15px;
      cursor: pointer;
    }
    
    .quick-amount {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }
    
    .quick-amount button {
      background-color: white;
      border: 1px solid var(--border-color);
      border-radius: 20px;
      padding: 5px 15px;
      cursor: pointer;
    }
    
    .quick-amount button:hover {
      background-color: var(--light-color);
    }
    
    .pay-button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 15px;
      border-radius: 4px;
      font-weight: bold;
      cursor: pointer;
      margin-top: auto;
    }
    
    .pay-button:hover {
      background-color: var(--secondary-color);
    }
    
    .discount-input {
      width: 80px;
      text-align: right;
      padding: 5px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
    }
    
    #suggestions, #customer-suggestions {
      position: absolute;
      width: 100%;
      max-height: 300px;
      overflow-y: auto;
      background-color: white;
      border: 1px solid var(--border-color);
      border-radius: 0 0 4px 4px;
      z-index: 1000;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .list-group-item {
      display: flex;
      align-items: center;
      padding: 10px;
      border-bottom: 1px solid var(--border-color);
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    .list-group-item:hover {
      background-color: var(--light-color);
    }
    
    .list-group-item img {
      width: 50px;
      height: 50px;
      object-fit: cover;
      margin-right: 10px;
      border-radius: 4px;
    }
    
    .list-group-item .product-info {
      flex: 1;
    }
    
    .list-group-item .product-name {
      font-weight: 500;
      margin-bottom: 3px;
    }
    
    .list-group-item .product-price {
      color: var(--primary-color);
      font-weight: 500;
    }
    
    .list-group-item .product-stock {
      font-size: 0.8rem;
      color: #666;
    }
    
    .remove-btn {
      background-color: #dc3545;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 5px 10px;
      cursor: pointer;
    }
    
    .remove-btn:hover {
      background-color: #c82333;
    }
    
    @media (max-width: 992px) {
      .main-content {
        flex-direction: column;
      }
      
      .left-panel, .right-panel {
        flex: none;
        width: 100%;
      }
      
      .right-panel {
        border-left: none;
        border-top: 1px solid var(--border-color);
      }
    }
    
	  /* T√πy ch·ªânh modal th√†nh c√¥ng */
	  #orderSuccessModal .modal-content {
	    border: none;
	    border-radius: 8px;
	    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
	    overflow: hidden;
	  }
	  
	  #orderSuccessModal .modal-header {
	    border-bottom: 0 none !important; /* S·ª≠ d·ª•ng !important ƒë·ªÉ ghi ƒë√® */
	    padding: 15px 20px;
	  }
	  
	  /* Th√™m CSS c·ª• th·ªÉ ƒë·ªÉ ƒë·∫£m b·∫£o kh√¥ng c√≥ ƒë∆∞·ªùng vi·ªÅn */
	  #orderSuccessModal .modal-header::after {
	    display: none !important;
	  }
	  
	  #orderSuccessModal .btn-close:focus {
	    box-shadow: none;
	    outline: none;
	  }
	  
	  #orderSuccessModal .modal-footer {
	    border-top: 1px solid #ffe0cc;
	    padding: 15px 20px;
	  }
	  
	  #orderSuccessModal .btn {
	    transition: all 0.3s ease;
	  }
	  
	  #orderSuccessModal .btn:hover {
	    background-color: #ff8533 !important;
	    transform: translateY(-2px);
	    box-shadow: 0 4px 8px rgba(255, 98, 0, 0.2);
	  }
	  
	  #orderSuccessModal .btn:active {
	    transform: translateY(0);
	    box-shadow: 0 2px 4px rgba(255, 98, 0, 0.2);
	  }
	  
	  #orderSuccessModal .success-icon {
	    animation: scaleIn 0.5s ease-out;
	  }
	  
	  @keyframes scaleIn {
	    0% {
	      transform: scale(0);
	      opacity: 0;
	    }
	    100% {
	      transform: scale(1);
	      opacity: 1;
	    }
	  }
  </style>
</head>
<body>
  <div class="header">
    <div class="header-container">
      <div class="logo-search-container">
        <img th:src="@{/img/logo.png}" alt="Logo" class="logo">
        <div class="search-bar">
          <i class="fas fa-search search-icon"></i>
          <input type="text" id="product-search" placeholder="T√¨m s·∫£n ph·∫©m...">
          <ul id="suggestions" class="list-group"></ul>
        </div>
      </div>
      
      <div class="user-menu">
        <a href="#" class="dropdown-toggle" id="accountDropdown">
          <i class="fas fa-user"></i> T√†i kho·∫£n c·ªßa t√¥i
        </a>
        <div class="dropdown-menu" aria-labelledby="accountDropdown">
          <a th:href="@{/employee/formProfile}">
            <i class="fas fa-user"></i> Th√¥ng tin c√° nh√¢n
          </a>
          <a th:href="@{/employee/form_changePassword}">
            <i class="fas fa-key"></i> ƒê·ªïi m·∫≠t kh·∫©u
          </a>
          <a th:href="@{/employee/bill}">
            <i class="fas fa-file-invoice"></i> Qu·∫£n l√Ω h√≥a ƒë∆°n
          </a>
          <div class="dropdown-divider"></div>
          <form th:action="@{/logout}" method="post">
            <button type="submit" class="logout-btn">
              <i class="fas fa-sign-out-alt"></i> ƒêƒÉng xu·∫•t
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
  
  <div class="main-content">
    <div class="left-panel">
      <div class="order-table-container">
        <table class="order-table">
          <thead>
            <tr>
              <th>STT</th>
              <th>M√£ SP</th>
              <th>S·∫£n ph·∫©m</th>
              <th>S·ªë l∆∞·ª£ng</th>
              <th>ƒê∆°n gi√°</th>
              <th>Th√†nh ti·ªÅn</th>
              <th>Thao t√°c</th>
            </tr>
          </thead>
          <tbody id="offOrder-items"></tbody>
        </table>
      </div>
      
      <input type="text" class="note-input" placeholder="üñä Ghi ch√∫ ƒë∆°n h√†ng">
    </div>
    
    <div class="right-panel">
      <div class="order-summary">
        <div class="summary-header">
          <div>
            <h5 th:text="${employeeName}">Nh√¢n vi√™n</h5>
          </div>
          <div id="datetime"></div>
        </div>
        
        <div class="summary-row">
          <span>T·ªïng ti·ªÅn h√†ng</span>
          <span id="total-amount">0‚Ç´</span>
        </div>
        
        <div class="summary-row">
          <span>Gi·∫£m gi√°(%)</span>
          <input type="text" class="discount-input" id="discount" placeholder="0%">
        </div>
        
        <div class="summary-row highlight">
          <span>Kh√°ch c·∫ßn tr·∫£</span>
          <span id="final-amount">0‚Ç´</span>
        </div>
        
        <div class="payment-methods">
          <label>
            <input type="radio" name="payment" value="cash" checked> Ti·ªÅn m·∫∑t
          </label>
          <label>
            <input type="radio" name="payment" value="bank"> Chuy·ªÉn kho·∫£n
          </label>
        </div>
        
        <input type="hidden" id="employeeId" th:value="${employeeId}">
        <div class="mb-3">
          <label for="customer-search" class="form-label">T√¨m kh√°ch h√†ng</label>
          <input type="text" class="form-control" id="customer-search" placeholder="T√¨m kh√°ch h√†ng...">
          <ul class="list-group" id="customer-suggestions"></ul>
        </div>
        <div id="selected-customer"></div>
        <div class="mb-3">
          <label for="customer-phone" class="form-label">S·ªë ƒëi·ªán tho·∫°i kh√°ch h√†ng</label>
          <input type="text" id="customer-phone" class="form-control">
        </div>
        
        <button class="pay-button">THANH TO√ÅN</button>
      </div>
    </div>
  </div>
	
  <!-- Modal -->
	<div class="modal fade" id="orderSuccessModal" tabindex="-1" aria-labelledby="orderSuccessLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header" style="background-color: #ff6200; color: white; border-bottom: 0 none !important;">
        <h5 class="modal-title" id="orderSuccessLabel">
          <i class="fas fa-check-circle me-2"></i>Th√†nh c√¥ng
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="ƒê√≥ng"></button>
      </div>
      <div class="modal-body text-center py-4">
        <div class="success-icon mb-3">
          <i class="fas fa-check-circle" style="font-size: 3rem; color: #ff6200;"></i>
        </div>
        <p class="mb-0" style="font-size: 1.1rem;">ƒê∆°n h√†ng ƒë√£ ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng!</p>
      </div>
      <div class="modal-footer" style="background-color: #fff4eb; border-top: 1px solid #ffe0cc;">
        <button type="button" class="btn" data-bs-dismiss="modal" 
                style="background-color: #ff6200; color: white; border-radius: 4px; padding: 8px 20px; border: none;">
          ƒê√≥ng
        </button>
      </div>
    </div>
  </div>
</div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/js/all.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    let cart = [];
    let selectedCustomer = null;

    async function api(url, method = 'GET', data) {
      const opts = { method, headers: {'Content-Type':'application/json'} };
      if (data) opts.body = JSON.stringify(data);
      const res = await fetch(url, opts);
      if (!res.ok) throw new Error(`HTTP error! Status: ${res.status}`);
      return res.json();
    }

    const searchInput = document.getElementById('product-search');
    const suggestions = document.getElementById('suggestions');

    searchInput.addEventListener('input', async function() {
      const q = this.value.trim();
      if (!q) {
        suggestions.innerHTML = '';
        return;
      }
      try {
        const products = await api(`/api/OffOrder/search?q=${encodeURIComponent(q)}`);
        suggestions.innerHTML = products.map(p => `
          <li class="list-group-item"
              data-id="${p.id}"
              data-name="${p.name}"
              data-image-url="${p.imageUrl}"
              data-price="${p.price}"
              data-discount="${p.discount || 0}"
              data-stock="${p.quantity}">
            <img src="/images/${p.imageUrl}" alt="${p.name}">
            <div class="product-info">
              <div class="product-name">${p.name}</div>
              <div class="product-price">${p.price.toLocaleString('vi-VN')}‚Ç´</div>
              <div class="product-stock">T·ªìn kho: ${p.quantity}</div>
            </div>
            ${p.discount ? `<span class="badge bg-danger">-${p.discount}%</span>` : ''}
          </li>
        `).join('');
      } catch (error) {
        console.error('L·ªói t√¨m ki·∫øm s·∫£n ph·∫©m:', error);
        suggestions.innerHTML = '<li class="list-group-item">C√≥ l·ªói x·∫£y ra khi t√¨m ki·∫øm</li>';
      }
    });

    suggestions.addEventListener('click', function(e) {
      const li = e.target.closest('li');
      if (!li) return;
      const id = Number(li.dataset.id);
      const name = li.dataset.name;
      const imageUrl = li.dataset.imageUrl;
      const price = Number(li.dataset.price);
      const discount = Number(li.dataset.discount);
      const stock = Number(li.dataset.stock);

      const item = cart.find(x => x.id === id);
      if (item) {
        if (item.quantity < stock) {
          item.quantity++;
        } else {
          alert('Kh√¥ng th·ªÉ tƒÉng n·ªØa, ƒë√£ ch·∫°m t·ªìn kho!');
        }
      } else {
        cart.push({ id, name, imageUrl, price, discount, stock, quantity: 1 });
      }
      renderOffOrder();
      suggestions.innerHTML = '';
      searchInput.value = '';
    });

    document.addEventListener('click', function(e) {
      if (!searchInput.contains(e.target) && !suggestions.contains(e.target)) {
        suggestions.innerHTML = '';
      }
    });

    document.getElementById('customer-search').addEventListener('input', async function() {
      const q = this.value.trim();
      if (!q) {
        document.getElementById('customer-suggestions').innerHTML = '';
        return;
      }
      try {
        const customers = await api(`/api/OffOrder/searchCustomers?q=${encodeURIComponent(q)}`);
        if (!customers || customers.length === 0) {
          document.getElementById('customer-suggestions').innerHTML = '<li class="list-group-item">Kh√¥ng t√¨m th·∫•y kh√°ch h√†ng</li>';
          return;
        }
        const list = customers.map(c => 
          `<li class="list-group-item list-group-item-action" 
               data-id="${c.id}"
               data-name="${c.name}"
               data-phone="${c.phone}"
            >
            ${c.name} - ${c.phone}
          </li>`
        ).join('');
        document.getElementById('customer-suggestions').innerHTML = list;
      } catch (error) {
        console.error('L·ªói t√¨m ki·∫øm kh√°ch h√†ng:', error);
        document.getElementById('customer-suggestions').innerHTML = '<li class="list-group-item">C√≥ l·ªói x·∫£y ra khi t√¨m ki·∫øm</li>';
      }
    });

    document.getElementById('customer-suggestions').addEventListener('click', function(e) {
  	  const li = e.target.closest('li');
  	  if (!li) return;
  	  
  	  const customerId = li.dataset.id;
  	  const customerName = li.dataset.name;
  	  const customerPhone = li.dataset.phone;
  	  
  	  // L∆∞u th√¥ng tin kh√°ch h√†ng v√†o bi·∫øn
  	  selectedCustomer = { id: customerId, name: customerName, phone: customerPhone };
  	  
  	  // Hi·ªÉn th·ªã th√¥ng tin kh√°ch h√†ng c√πng n√∫t x√≥a
  	  document.getElementById('selected-customer').innerHTML = `
  	    ${customerName} - ${customerPhone}
  	    <button id="remove-customer" class="btn btn-sm btn-danger ms-2">X√≥a</button>
  	  `;
  	  
  	  // C·∫≠p nh·∫≠t tr∆∞·ªùng s·ªë ƒëi·ªán tho·∫°i v√† kh√≥a ch·ªânh s·ª≠a
  	  document.getElementById('customer-phone').value = customerPhone;
  	  document.getElementById('customer-phone').readOnly = true;
  	  
  	  // X√≥a danh s√°ch g·ª£i √Ω v√† tr∆∞·ªùng t√¨m ki·∫øm
  	  this.innerHTML = '';
  	  document.getElementById('customer-search').value = '';
  	  
  	  // X·ª≠ l√Ω s·ª± ki·ªán click cho n√∫t x√≥a
  	  document.getElementById('remove-customer').addEventListener('click', function() {
  	    // Reset th√¥ng tin kh√°ch h√†ng
  	    selectedCustomer = null;
  	    document.getElementById('selected-customer').innerHTML = '';
  	    document.getElementById('customer-phone').value = '';
  	    document.getElementById('customer-phone').readOnly = false;
  	  });
  	});

    function renderOffOrder() {
      const tbody = document.getElementById('offOrder-items');
      tbody.innerHTML = cart.map((p, index) => {
        const totalPrice = p.price * p.quantity * (1 - p.discount/100);
        return `
          <tr>
            <td>${index + 1}</td>
            <td>${p.id}</td>
            <td>
              <div style="display: flex; align-items: center;">
                <img src="/images/${p.imageUrl}" alt="${p.name}" style="margin-right: 10px;">
                <div>
                  ${p.name}
                  ${p.discount ? `<div style="color: red;">-${p.discount}%</div>` : ''}
                </div>
              </div>
            </td>
            <td>
              <div class="quantity-control">
                <button class="minus" data-id="${p.id}">-</button>
                <span>${p.quantity}</span>
                <button class="plus" data-id="${p.id}">+</button>
              </div>
            </td>
            <td>${p.price.toLocaleString('vi-VN')}‚Ç´</td>
            <td>${totalPrice.toLocaleString('vi-VN')}‚Ç´</td>
            <td>
              <button class="remove-btn" data-id="${p.id}">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          </tr>
        `;
      }).join('');

      tbody.querySelectorAll('.plus').forEach(btn => {
        btn.onclick = () => {
          const id = Number(btn.dataset.id);
          const item = cart.find(x => x.id === id);
          if (item && item.quantity < item.stock) {
            item.quantity++;
            renderOffOrder();
          } else {
            alert('Kh√¥ng th·ªÉ tƒÉng n·ªØa, ƒë√£ ch·∫°m t·ªìn kho!');
          }
        };
      });
      
      tbody.querySelectorAll('.minus').forEach(btn => {
        btn.onclick = () => {
          const id = Number(btn.dataset.id);
          const item = cart.find(x => x.id === id);
          if (item) {
            item.quantity--;
            if (item.quantity <= 0) {
              cart = cart.filter(x => x.id !== id);
            }
            renderOffOrder();
          }
        };
      });
      
      tbody.querySelectorAll('.remove-btn').forEach(btn => {
        btn.onclick = () => {
          const id = Number(btn.dataset.id);
          cart = cart.filter(x => x.id !== id);
          renderOffOrder();
        };
      });

      const total = cart.reduce((sum, p) => sum + p.price * p.quantity * (1 - p.discount/100), 0);
      document.getElementById('total-amount').textContent = total.toLocaleString('vi-VN') + '‚Ç´';
      updateFinalAmount();
    }

    function updateFinalAmount() {
      const total = cart.reduce((sum, p) => sum + p.price * p.quantity * (1 - p.discount/100), 0);
      const discount = Number(document.getElementById('discount').value) || 0;
      const final = total * (1 - discount / 100);
      document.getElementById('total-amount').textContent = total.toLocaleString('vi-VN') + '‚Ç´';
      document.getElementById('final-amount').textContent = final.toLocaleString('vi-VN') + '‚Ç´';
    }

    document.getElementById('discount').addEventListener('input', updateFinalAmount);

    document.querySelector('.pay-button').addEventListener('click', async function() {
      if (cart.length === 0) {
        alert('Vui l√≤ng th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng');
        return;
      }
      const phone = document.getElementById('customer-phone').value;
      if (!phone) {
        alert('Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i kh√°ch h√†ng');
        return;
      }
      const discount = Number(document.getElementById('discount').value) || 0;
      const paymentType = document.querySelector('input[name="payment"]:checked').value === 'cash' ? 0 : 1;
      const note = document.querySelector('.note-input').value;
      const employeeId = Number(document.getElementById('employeeId').value) || null;
      const customerId = selectedCustomer ? selectedCustomer.id : null;
      const items = cart.map(item => ({
        productId: item.id,
        quantity: item.quantity,
        cost: item.price * (1 - item.discount / 100)
      }));
      const total = cart.reduce((sum, p) => sum + p.price * p.quantity * (1 - p.discount/100), 0);
      const orderRequest = { customerId, employeeId, phone, cost: total, discount, paymentType, note, items };
      try {
        await api('/api/OffOrder/createOrder', 'POST', orderRequest);
        cart = [];
        selectedCustomer = null;
        document.getElementById('selected-customer').textContent = '';
        document.getElementById('customer-phone').value = '';
        document.getElementById('customer-phone').readOnly = false;
        document.getElementById('customer-search').value = '';
        document.getElementById('discount').value = '';
        renderOffOrder();
        const modal = new bootstrap.Modal(document.getElementById('orderSuccessModal'));
        modal.show();
      } catch (error) {
        console.error('L·ªói khi t·∫°o ƒë∆°n h√†ng:', error);
        alert('C√≥ l·ªói x·∫£y ra khi t·∫°o ƒë∆°n h√†ng');
      }
    });

    const dtEl = document.getElementById('datetime');
    function updateDateTime() {
      const now = new Date();
      dtEl.textContent = now.toLocaleDateString('vi-VN') + ' ' + now.toLocaleTimeString('vi-VN');
    }
    updateDateTime();
    setInterval(updateDateTime, 1000);

    document.addEventListener('DOMContentLoaded', function() {
      const dropdownToggle = document.getElementById('accountDropdown');
      const dropdownMenu = document.querySelector('.dropdown-menu');
      
      dropdownToggle.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        dropdownMenu.classList.toggle('show');
      });
      
      document.addEventListener('click', function(e) {
        if (dropdownMenu.classList.contains('show') && !dropdownToggle.contains(e.target)) {
          dropdownMenu.classList.remove('show');
        }
      });
    });
  </script>
</body>
</html>